{% extends 'header.html' %}
{% load static %}
{% block content%}
   <body>
   <style>
       .zoom-on-hover {
           transition: transform 0.3s ease-in-out; /* Ajoute une transition douce pour l'effet de zoom */
       }

       .zoom-on-hover:hover {
           transform: scale(1.1); /* Applique le zoom au survol */
       }
   </style>
      <!-- loader Start -->
      <div id="loading">
         <div id="loading-center">
         </div>
      </div>
      <!-- loader END -->
      <!-- Wrapper Start -->
      <div class="wrapper">
         <!-- Sidebar  -->
          {% include 'slide.html' %}
         <!-- TOP Nav Bar -->
          {% include 'top_navbar.html' %}
         <!-- TOP Nav Bar END -->
         <!-- Page Content  -->
         <div id="content-page" class="content-page">
            <div class="container-fluid">
               <div class="row d-flex justify-content-center">
                  <div class="col-sm-12 col-lg-9">
                     <div class="iq-card">
                         <div class="card-header">
                             <div class="iq-card-header d-flex justify-content-between">
                               <div class="iq-header-title">
                                  <h4 class="card-title">Formulaire d'ajout de véhicule</h4>
                               </div>
                            </div>
                         </div>
                        <div class="iq-card-body">
                            <form class="form-horizontal" method="post" action="{% url 'vehicule:Ajouter_vehicule' %}" enctype="multipart/form-data">
                            {% csrf_token %}
{#                                <div class="row">#}
{#                                    <div class="col-12 col-md-12 col-lg-12 text-right">#}
{#                                        <div class="row justify-content-evenly">#}
{#                                            <div class="col-12 col-md-6 col-lg-6" s>#}
{#                                                <button type="button" class="iq-icons-list btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo" onclick="ajoutMarque()">#}
{#                                                    <i class="ion-plus-circled"></i>Ajouter une marque#}
{#                                                </button>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
                                <div class="row">
                                    <div class="col-12 col-md-6 col-lg-6">
                                        <div class="col-md-12" style="margin-top: 15px">
                                            <label for="marque" class="font-weight-bold">Marque :</label>
                                            {{ form.marque }}
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="numero_immatriculation" class="font-weight-bold">Numero d'immatriculation :</label>
                                            <input type="text" class="form-control" id="numero_immatriculation" placeholder="Numero Immatriculation" name="numero_immatriculation"  value="{% if form.numero_immatriculation.value %}{{ form.numero_immatriculation.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="carte_grise" class="font-weight-bold">Numero de la carte grise :</label>
                                            <input type="text" class="form-control" id="carte_grise" placeholder="Numero de la carte grise" name="carte_grise" value="{% if form.carte_grise.value %}{{ form.carte_grise.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="couleur de la voiture" class="font-weight-bold">Couleur de la voiture :</label>
                                            <input type="text" class="form-control" id="couleur de la voiture" placeholder="Couleur de la voiture" name="couleur" value="{% if form.couleur.value %}{{ form.couleur.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="date_mise_circulation" class="font-weight-bold">Date de mise circulation :</label>
                                            <input type="date" class="form-control" id="date_mise_circulation" placeholder="date mise circulation" name="date_mise_circulation" value="{% if form.date_mise_circulation.value %}{{ form.date_mise_circulation.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="date_d_edition" class="font-weight-bold">Date d'édition :</label>
                                            <input type="date" class="form-control" id="date_d_edition" placeholder="Date d'edition" name="date_d_edition" value="{% if form.date_d_edition.value %}{{ form.date_d_edition.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="date_expiration_assurance" class="font-weight-bold">Date d'expiration assurance :</label>
                                            <input type="date" class="form-control" id="date_expiration_assurance" placeholder="Date expiration assurance" name="date_expiration_assurance" value="{% if form.date_expiration_assurance.value %}{{ form.date_expiration_assurance.value }}{% endif %}">
                                        </div>
                                    </div>

                                    <div class="col-12 col-md-6 col-lg-6">
                                        <div class="form-group col-md-12 text-right">
                                            <button type="button" class="iq-icons-list btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo" onclick="ajoutMarque()">
                                                <i class="ion-plus-circled"></i>Ajouter une marque
                                            </button>
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="date_videnge" class="font-weight-bold">Date de videnge :</label>
                                            <input type="date" class="form-control" id="date_videnge" placeholder="Date videnge" name="date_videnge" value="{% if form.date_videnge.value %}{{ form.date_videnge.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="carrosserie" class="font-weight-bold">Carrosserie :</label>
                                            <input type="text" class="form-control" id="carrosserie" placeholder="carrosserie" name="carrosserie" value="{% if form.carrosserie.value %}{{ form.carrosserie.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="place_assises" class="font-weight-bold">Place assises :</label>
                                            <input type="number" class="form-control" id="place_assises" placeholder="Place assises" name="place_assises" value="{% if form.carte_grise.value %}{{ form.place_assises.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="kilometrage" class="font-weight-bold">Kilométrage :</label>
                                            <input type="number" class="form-control" id="kilometrage" placeholder="Kilometrage" name="kilometrage" value="{% if form.kilometrage.value %}{{ form.kilometrage.value }}{% endif %}">
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="energie" class="font-weight-bold">Energie :</label>
                                            {{ form.energie }}
                                        </div>

                                        <div class="form-group col-md-12">
                                            <label for="images" class="font-weight-bold">Sélectionner des images :</label>
                                            <div class="custom-file">
                                                <input type="file" class="custom-file-input" id="customFile" required name="images" multiple value="{% if form.images.value %}{{ form.images.value }}{% endif %}">
                                                <label class="custom-file-label" for="customFile">Choisir des images</label>
                                            </div>
                                            <small class="form-text text-muted">Vous pouvez sélectionner plusieurs images en même temps.</small>
                                        </div>

                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary" style="width: 100%">Ajouter</button>
                            </form>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- Wrapper END -->
      <!-- Footer -->
      {% include 'footer.html' %}
      <div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true" style="top:0; bottom: 0">
          <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="successModalLabel" style="display: flex; justify-content: center; align-items: center;">Véhicule ajouter avec succès!!</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body" style="display: flex; justify-content: center; align-items: center;">
                      <img src="{% static 'images/Success.gif' %}" alt="GIF animé" style="max-width: 30%; height: auto;">
                  </div>
                  <div class="modal-footer text-center" style="display: flex; justify-content: center; align-items: center;">
                      <button type="button" class="zoom-on-hover btn btn-danger align-items-center" data-dismiss="modal" onclick="fermerModal()">Fermer</button>
                      <a type="button" class="zoom-on-hover btn btn-success align-items-center text-white" href="{% url 'vehicule:liste_vehicules' %}">Voir tout les véhicules</a>
                  </div>
              </div>
          </div>
      </div>

   <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true" style="top:0; bottom: 0">
       <div class="modal-dialog modal-dialog-centered" role="document">
           <div class="modal-content">
               <div class="modal-header h4 text-center" style="text-align: center">
                   Erreur lors de l'ajout du véhicule!!!
               </div>
               <div class="modal-body" style="display: flex; justify-content: center; align-items: center;">
                   <div id="formErrors" class="text-danger h5">
                      <div class="text-center"> <img src="{% static 'images/error.gif' %}" alt="GIF animé" style="max-width: 30%; height: auto;text-align: center"><br></div>
                       {% if form.errors %}
                           {% for field, errors in form.errors.items %}
                               <p><strong>{{ field|title }}:</strong> {{ errors.0 }}</p>
                           {% endfor %}
                       {% endif %}
                   </div>
               </div>
               <div class="modal-footer text-center" style="display: flex; justify-content: center; align-items: center;">
                   <button type="button" class="zoom-on-hover btn btn-danger align-items-center" data-dismiss="modal">Fermer</button>
               </div>
           </div>
       </div>
   </div>
   <div class="modal fade" id="ajoutMarque" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h1 class="modal-title fs-5" id="exampleModalLabel">Ajouter une marque</h1>
               </div>
               <div class="modal-body">
                   <form method="post" id="marqueForm">
                       {% csrf_token %}
                       <div class="mb-3">
{#                           <label for="marque" class="col-form-label">Marque:</label>#}
                           <input type="text" class="form-control" id="marque" name="marque" required placeholder="Entrer le nom de la marque ">
                           <div id="marque-error" class="text-danger"></div>
                       </div>

                       <div class="modal-footer">
                           <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="fermerModal()">Annuler</button>
                           <button type="button" class="btn btn-primary" onclick="ajouterMarque()">Ajouter</button>
                       </div>
                   </form>
               </div>
           </div>
       </div>
   </div>

   <div class="modal fade" id="existModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h1 class="modal-title fs-5 text-center " style="text-align: center; font-size: 30px; margin: auto  " id="exampleModalLabel">
                       Erreur!!!
                       <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1080 1080" width="100" height="100" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px); content-visibility: visible;">
                           <defs><clipPath id="__lottie_element_699">
                               <rect width="1080" height="1080" x="0" y="0">

                               </rect>
                           </clipPath>
                           </defs>
                           <g clip-path="url(#__lottie_element_699)">
                               <g transform="matrix(1,0,0,1,539.9979858398438,736.989990234375)" opacity="1" fill="rgb(230,14,14)" font-size="405" font-family="Lato" font-style="normal" font-weight="700" aria-label="!" style="display: block;"><g stroke-linecap="butt" stroke-linejoin="round" stroke-miterlimit="4" transform="matrix(1,0,0,1,-73.00125122070312,0)" opacity="1" style="display: inherit;">
                                   <g>
                                       <g transform="matrix(1,0,0,1,0,0)" opacity="1" style="display: block;">
                                           <path d=" M44.65,-15.49 C46.2,-11.78 48.36,-8.57 51.13,-5.87 C53.9,-3.17 57.17,-1.04 60.95,0.51 C64.73,2.06 68.78,2.84 73.1,2.84 C77.29,2.84 81.27,2.06 85.05,0.51 C88.83,-1.04 92.07,-3.17 94.77,-5.87 C97.47,-8.57 99.63,-11.78 101.25,-15.49 C102.87,-19.2 103.68,-23.22 103.68,-27.54 C103.68,-31.72 102.87,-35.7 101.25,-39.49 C99.63,-43.27 97.47,-46.51 94.77,-49.21 C92.07,-51.9 88.83,-54.07 85.05,-55.69 C81.27,-57.31 77.29,-58.12 73.1,-58.12 C68.78,-58.12 64.73,-57.31 60.95,-55.69 C57.17,-54.07 53.9,-51.9 51.13,-49.21 C48.36,-46.51 46.2,-43.27 44.65,-39.49 C43.1,-35.7 42.32,-31.72 42.32,-27.54 C42.32,-23.22 43.1,-19.2 44.65,-15.49z M50.02,-292.82 C50.02,-292.82 50.02,-176.99 50.02,-176.99 C50.02,-164.7 50.63,-152.65 51.84,-140.84 C53.06,-129.02 54.68,-116.5 56.7,-103.28 C56.7,-103.28 90.52,-103.28 90.52,-103.28 C92.54,-116.5 94.16,-129.02 95.38,-140.84 C96.59,-152.65 97.2,-164.7 97.2,-176.99 C97.2,-176.99 97.2,-292.82 97.2,-292.82 C97.2,-292.82 50.02,-292.82 50.02,-292.82z">

                                           </path>
                                           <g opacity="1" transform="matrix(4.050000190734863,0,0,4.050000190734863,0,0)">

                                           </g>
                                       </g>
                                   </g>
                               </g>
                               </g>
                               <g transform="matrix(1.309999942779541,0,0,1.309999942779541,553.0999755859375,585.5198974609375)" opacity="1" style="display: block;">
                                   <g opacity="1" transform="matrix(1,0,0,1,-10,36)">
                                       <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(253,0,0)" stroke-opacity="1" stroke-width="28" d=" M1.7328201929443267e-14,-282.9909973144531 C1.7328201929443267e-14,-282.9909973144531 245.077392578125,141.49549865722656 245.077392578125,141.49549865722656 C245.077392578125,141.49549865722656 -245.077392578125,141.49549865722656 -245.077392578125,141.49549865722656 C-245.077392578125,141.49549865722656 1.7328201929443267e-14,-282.9909973144531 1.7328201929443267e-14,-282.9909973144531z">

                                       </path>
                                   </g>
                               </g>
                           </g>
                       </svg>
                   </h1>
               </div>
               <div class="modal-body text-danger" style="font-size: 30px">
                   Cette marque existe déjà.
               </div>
           </div>
       </div>
   </div>

   <script>
       {% if messages %}
       {% for messages in messages %}
           $(document).ready(function() {
               $('#successModal').modal('show');
           });
           {% endfor %}
       {% endif %}


       {% if form.errors %}
           $(document).ready(function() {
               $('#errorModal').modal('show');
           });
       {% endif %}
   </script>



   <script>
       function ajoutMarque() {
           $('#ajoutMarque').modal('show');
       }
       function fermerModal() {

           // Fermer le modal
           $('#ajoutMarque').modal('hide');
       }
       {% if form.errors %}
           function existModal() {
               $('#existModal').modal('show');
           }
       {% endif %}
   </script>
   <script>
       function ajouterMarque() {
           $.ajax({
               type: 'POST',
               url: '{% url "vehicule:ajouter_marque" %}',
               data: $('#marqueForm').serialize(),
               success: function(response) {
                   if (response.success) {
                       $('#ajoutMarque').modal('hide');
                       location.reload(true);
                   } else if (response.error) {
                       $('#existModal').modal('show');
                   } else if (response.errors) {
                       for (var field in response.errors) {
                           $('#' + field + '-error').text(response.errors[field]);
                       }
                   }
               },
               error: function(response) {
                   $('#existModal').modal('show');
               }
           });
       }

   </script>
   </body>
{% endblock %}